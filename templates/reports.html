{% extends "base.html" %}
{% block title %}Reports{% endblock %}
{% block content %}
<div class="container mt-4">
  <h1 class="mb-3">Reports Dashboard</h1>
  <div class="card shadow-sm p-4">
    <form method="get" action="{{ url_for('generate_report') }}">
      <div class="row g-3 align-items-end">
        <div class="col-md-4">
          <label class="form-label">Select Report Type</label>
          <select class="form-select" name="report_type" id="report_type" required>
            <option value="">-- Choose --</option>
            <option value="catalog_purchase">Catalog Purchase Report (by Item)</option>
            <option value="driver_activity">Driver Activity Report</option>
            <option value="driver_summary">Driver Purchase Summary</option>
            <option value="driver_detail">Driver Purchase Detail</option>
            <option value="driver_points">Driver Point Transactions</option>
            <option value="sponsor_summary">Total Sponsor Sales Summary</option>
            <option value="sponsor_detail">Sales by Sponsor (Detail)</option>
            <option value="audit_log">Audit Log Report</option>
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label">Filter by Driver (optional)</label>
          <input type="text" class="form-control" name="driver" placeholder="Enter driver username">
        </div>

        <div class="col-md-3">
          <label>Filter by Sponsor (optional)</label>
          <input type="text" class="form-control" name="sponsor" placeholder="Enter sponsor username">
        </div>

        <!-- Category filter (ONLY for audit_log) -->
        <div class="col-md-4" id="category-filter" style="display:none;">
          <label class="form-label">Category (optional)</label>
          <select name="category" class="form-select">
            <option value="">-- All Categories --</option>
            <option value="points_added">Points Added</option>
            <option value="points_removed">Points Removed</option>
            <option value="login">Login</option>
            <option value="driver_application">Driver Application</option>
          </select>
        </div>
      </div>
        
        <div class="col-md-2">
          <label class="form-label">Start Date (optional)</label>
          <input type="date" class="form-control" name="start_date">
        </div>

        <div class="col-md-2">
          <label class="form-label">End Date (optional)</label>
          <input type="date" class="form-control" name="end_date">
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-md-2 ms-auto d-grid">
          <button class="btn btn-primary">Generate</button>
        </div>
      </div>
    </form>
  </div>
</div>
<!-- Simple JS to toggle the category dropdown -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const reportSelect = document.getElementById('report_type');
  const categoryGroup = document.getElementById('category-filter');

  function updateCategoryVisibility() {
    if (!reportSelect || !categoryGroup) return;
    if (reportSelect.value === 'audit_log') {
      categoryGroup.style.display = '';
    } else {
      categoryGroup.style.display = 'none';
      const select = categoryGroup.querySelector('select');
      if (select) select.value = '';
    }
  }

  if (reportSelect) {
    reportSelect.addEventListener('change', updateCategoryVisibility);
    // Run once on page load in case there is a pre-selected value
    updateCategoryVisibility();
  }
});
</script>
{% endblock %}
